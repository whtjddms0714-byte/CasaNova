---
layout: default
title: "ëŒ€ì¶œ ì¶”ì²œ ê²°ê³¼ (Info 2)"
permalink: /loans.html  #
---


<h1>ëŒ€ì¶œ ìƒí’ˆ ì¶”ì²œ</h1>

<p>
  ì…ë ¥í•œ ì •ë³´ë¡œ Django API(<code>/api/recommend-loans/</code>)ì— ìš”ì²­í•˜ì—¬ ì¶”ì²œ ëŒ€ì¶œ ìƒí’ˆì„ ì¡°íšŒí•©ë‹ˆë‹¤.
</p>

<div class="header-action" style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
    <span id="status-box" style="font-weight: bold; font-size: 1.1em;">ìš”ì²­ ì¤€ë¹„ ì¤‘...</span>
    <a href="/info-1/" style="color:var(--casa-nova-primary); text-decoration:none;">
        â† ì¬ë¬´ ì •ë³´ ë‹¤ì‹œ ì…ë ¥í•˜ê¸°
    </a>
</div>

<div id="loans-card-container" class="loan-card-grid" style="display: none;">
    </div>



<script>
  const API_BASE = "http://127.0.0.1:8000/api";
  const statusBox = document.getElementById("status-box");
  
  // â­ï¸â­ï¸â­ï¸ ìƒˆë¡œìš´ ì˜ì–´ ë‹¨ì–´ ëª©ë¡ ì •ì˜ â­ï¸â­ï¸â­ï¸
  const PRODUCT_NAMES = [
    "Prime", "Apex", "Elite", "Vision", "Trust", "Global", "Secure", "Capital",
    "Future", "Harmony", "Unity", "Clarity", "Ascent", "Liberty", "Venture", "Keystone"
  ];
  // â­ï¸â­ï¸â­ï¸ 

  function loadUserInfo() {
    const raw = localStorage.getItem("casanova_user_info");
    if (!raw) return null;
    try {
      return JSON.parse(raw);
    } catch (e) {
      console.error("Failed to parse user info:", e);
      return null;
    }
  }

  async function fetchLoanRecommendations() {
    const userInfo = loadUserInfo();
    const container = document.getElementById("loans-card-container");

    if (!userInfo) {
      statusBox.textContent =
        "ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. Find Home í˜ì´ì§€ì—ì„œ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      return;
    }

    statusBox.textContent = "ëŒ€ì¶œ ìƒí’ˆ ì¶”ì²œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";

    try {
      const res = await fetch(`${API_BASE}/recommend-loans/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_info: userInfo }),
      });

      if (!res.ok) {
        const text = await res.text();
        statusBox.textContent = `ì˜¤ë¥˜ ë°œìƒ: ${res.status} ${res.statusText} - ${text}`;
        return;
      }

      const data = await res.json();
      const loans = data.loan_recommendations || [];

      if (!loans.length) {
        // ê²°ê³¼ ì—†ìŒ ì¹´ë“œ ë¡œì§ ìœ ì§€
        const htmlContent = `
            <div class="result-not-found-card">
                <h2>ëŒ€ì¶œ ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤ ğŸ˜¥</h2>
                <p>
                    í˜„ì¬ ì…ë ¥í•˜ì‹  ì¬ë¬´ ì •ë³´ë¡œëŠ” ì¡°ê±´ì— ë§ëŠ” ëŒ€ì¶œ ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.
                </p>
                <div class="action-buttons">
                    <a href="/info-1/" class="btn-action btn-primary-action">
                        ì¬ë¬´ ì •ë³´ ë‹¤ì‹œ ì…ë ¥í•˜ê¸° â†’
                    </a>
                </div>
            </div>
        `;
        const parentContainer = container.parentNode; 
        parentContainer.innerHTML = htmlContent;
        return;
      }

      // â­ï¸â­ï¸â­ï¸ ìƒˆë¡œìš´ ìƒí’ˆ ì¹´ë“œ ë Œë”ë§ ë¡œì§ â­ï¸â­ï¸â­ï¸
      container.innerHTML = "";
      
      loans.slice(0, 20).forEach((loan, index) => {
        
        // 1. ì´ë¦„ ë³€ê²½ ë¡œì§: Word List ì‚¬ìš© (ìˆœí™˜í•˜ë©° ì‚¬ìš©)
        const wordIndex = index % PRODUCT_NAMES.length;
        const loanWord = PRODUCT_NAMES[wordIndex];
        const newLoanName = `${loanWord} Loan`; // "[ë‹¨ì–´] Loan" í˜•íƒœë¡œ í‘œì‹œ

        // ê¸ˆì•¡ì„ ë³´ê¸° ì¢‹ê²Œ í¬ë§·íŒ…
        const maxLoanFormatted = loan.max_loan.toLocaleString("ko-KR") + ' ì›';
        const scoreFormatted = loan.score.toFixed(2);
        
        const cardHTML = document.createElement('div');
        cardHTML.className = 'loan-item-card';
        cardHTML.innerHTML = `
            <h3>${newLoanName}</h3> <div class="loan-details">
                <div class="detail-box">
                    <strong>ì¶”ì²œ ì ìˆ˜</strong>
                    <span class="detail-value-score">${scoreFormatted}</span>
                </div>
                <div class="detail-box">
                    <strong>ìµœëŒ€ ëŒ€ì¶œì•¡</strong>
                    <span class="detail-value-amount">${maxLoanFormatted}</span>
                </div>
            </div>
            <button class="btn-select-loan" data-max-loan="${loan.max_loan}" data-loan-name="${loan.name}">
                ì´ ìƒí’ˆ ì„ íƒ ë° ì§„í–‰í•˜ê¸° â†’
            </button>
        `;
        
        container.appendChild(cardHTML);
      });

      statusBox.textContent = "ëŒ€ì¶œ ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.";
      container.style.display = "grid";

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    container.querySelectorAll('.btn-select-loan').forEach(btn => {
        btn.addEventListener("click", (e) => {
            const maxLoan = Number(e.currentTarget.dataset.maxLoan);
            const loanName = e.currentTarget.dataset.loanName;
            
            localStorage.setItem(
                "casanova_selected_loan_amount",
                JSON.stringify(maxLoan)
            );
            localStorage.setItem(
                "casanova_selected_loan_name",
                JSON.stringify(loanName)
            );
            window.location.href = "/properties.html";
        });
    });

    } catch (err) {
      console.error(err);
      statusBox.textContent =
        "ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
    }
  }

  fetchLoanRecommendations();
</script>
