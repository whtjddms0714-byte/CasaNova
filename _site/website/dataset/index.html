<section>
<h2>Dataset Explorer</h2>
<p class="lead">CSV 파일을 업로드하면 컬럼 요약, 결측치, 간단한 시각화를 제공합니다.</p>

<div class="card">
  <div class="input-row">
    <label>CSV 파일</label>
    <input id="fileInput" type="file" accept=".csv" />
    <button class="btn btn-primary" id="loadBtn">업로드</button>
  </div>

  <div id="datasetSummary" class="dataset-summary"></div>
</div>

<div class="card" style="margin-top:12px;">
  <h3>컬럼 시각화</h3>
  <div style="display:flex; gap:12px;">
    <div style="flex:1; min-height:260px;">
      <canvas id="chartHist"></canvas>
    </div>
    <div style="width:320px;">
      <div id="colList" style="max-height:260px; overflow:auto;"></div>
    </div>
  </div>
</div>

<script>
(function(){
  const fileInput = document.getElementById('fileInput');
  const loadBtn = document.getElementById('loadBtn');
  const summaryEl = document.getElementById('datasetSummary');
  const colList = document.getElementById('colList');
  let parsed = null;

  loadBtn.addEventListener('click', ()=>{
    const f = fileInput.files[0];
    if(!f){ alert('CSV 파일 선택하세요'); return; }
    const r = new FileReader();
    r.onload = e=>{
      const text = e.target.result;
      const lines = text.trim().split(/\r?\n/).filter(Boolean);
      const header = lines[0].split(',').map(h=>h.trim());
      const rows = lines.slice(1).map(l=>l.split(',').map(c=>c.trim()));
      parsed = {header, rows};
      summaryEl.innerHTML = '<div class="stat"><strong>Columns</strong><div class="muted">'+header.length+'</div></div><div class="stat"><strong>Rows</strong><div class="muted">'+rows.length+'</div></div>';
      colList.innerHTML = header.map(h=>`<div style="padding:8px;border-bottom:1px solid #f1f8ff;cursor:pointer" data-col="${h}">${h}</div>`).join('');
      colList.querySelectorAll('div[data-col]').forEach(el=>el.addEventListener('click', ()=> showColumn(el.dataset.col)));
    };
    r.readAsText(f);
  });

  function showColumn(col){
    const idx = parsed.header.indexOf(col);
    const vals = parsed.rows.map(r=>Number(r[idx])).filter(v=>!isNaN(v));
    if(!vals.length) { alert('Numeric column required.'); return; }
    if(window._datasetChart) window._datasetChart.destroy();
    window._datasetChart = CasaNova.createChart(document.getElementById('chartHist'), 'bar', {
      labels: vals.map((_,i)=>i+1),
      datasets:[{label:col, data:vals, backgroundColor:'rgba(0,102,204,0.6)'}]
    });
  }
})();
</script>
</section>
